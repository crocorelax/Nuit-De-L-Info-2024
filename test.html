<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poissons Cliquables</title>
    <link rel="stylesheet" href="src/css/global.css">
    <style>
        .score-container {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            z-index: 9999;
        }

        .score-container img {
            width: 50px;
            height: auto;
            margin-right: 10px;
        }

        .score-count {
            font-size: 1.5em;
            color: #fff;
            font-weight: bold;
        }

        .fish {
            position: absolute;
            width: 100px; /* Taille du poisson */
            height: auto;
            cursor: pointer;
            z-index: 10;
            user-select: none;
            -webkit-user-drag: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            transition: transform 8s linear; /* Poisson plus lent */
        }
    </style>
</head>
<body>
    <header class="main-header">
        <a href="index.html">
            <img src="src/assets/images/logo-home.png" alt="Retour Accueil" class="home-logo">
        </a>
    </header>

    <div class="container">
        <section class="intro">
            <h1>Poissons cliquables</h1>
            <p>Attrapez les poissons pour gagner des points ! Les plus rares rapportent plus.</p>
        </section>
    </div>

    <div class="score-container">
        <img src="src/assets/images/seau.png" alt="Seau">
        <span class="score-count" id="score">0</span>
    </div>

    <script>
        const scoreElement = document.getElementById('score');
        let score = 0;

        let windowWidth = window.innerWidth;
        let windowHeight = window.innerHeight;

        window.addEventListener('resize', () => {
            windowWidth = window.innerWidth;
            windowHeight = window.innerHeight;
        });

        // Définition des 5 types de poissons
        const fishTypes = [
            { src: 'src/assets/images/poisson/poisson_commun.png', points: 1, weight: 50 },    // Commun
            { src: 'src/assets/images/poisson/poisson_rare.png', points: 2, weight: 25 }, // Peu commun
            { src: 'src/assets/images/poisson/poisson_epique.png', points: 5, weight: 15 },     // Rare
            { src: 'src/assets/images/poisson/poisson_legendaire.png', points: 10, weight: 5 },     // Épique
            { src: 'src/assets/images/poisson/poisson_mythique.png', points: 20, weight: 2 } // Légendaire
        ];

        // Fonction pour obtenir un poisson en fonction du poids (tirage aléatoire pondéré)
        function getRandomFishType() {
            const totalWeight = fishTypes.reduce((sum, fish) => sum + fish.weight, 0);
            let random = Math.random() * totalWeight;
            for (const fish of fishTypes) {
                if (random < fish.weight) {
                    return fish;
                }
                random -= fish.weight;
            }
            return fishTypes[0]; // fallback au cas où (ne devrait pas arriver)
        }

        function createFish() {
            const fishData = getRandomFishType();

            const fish = document.createElement('img');
            fish.src = fishData.src;
            fish.classList.add('fish');
            fish.draggable = false; // Empêche le drag & drop

            const randomHeight = Math.floor(Math.random() * (windowHeight - 150)) + 50;
            fish.style.top = randomHeight + 'px';

            const directionLeftToRight = Math.random() > 0.5;

            if (directionLeftToRight) {
                // Poisson de gauche vers la droite
                fish.style.left = '-150px';
                // On inverse l'image pour qu'il "nage" vers la droite
                fish.style.transform = 'scaleX(-1)';

                requestAnimationFrame(() => {
                    requestAnimationFrame(() => {
                        fish.style.transform = `scaleX(-1) translateX(${windowWidth + 300}px)`;
                    });
                });

            } else {
                // Poisson de droite vers la gauche
                fish.style.left = (windowWidth + 150) + 'px';
                // Pas d'inversion nécessaire si l'image "fait face" vers la gauche par défaut
                requestAnimationFrame(() => {
                    requestAnimationFrame(() => {
                        fish.style.transform = `translateX(-${windowWidth + 300}px)`;
                    });
                });
            }

            document.body.appendChild(fish);

            fish.addEventListener('click', () => {
                // Ajout des points en fonction du poisson cliqué
                score += fishData.points;
                scoreElement.textContent = score;
                fish.remove();
            });

            fish.addEventListener('transitionend', () => {
                if (fish.parentNode) {
                    fish.remove();
                }
            });
        }

        function startFishGeneration() {
            // Interval plus fréquent (1 à 2 secondes)
            const interval = Math.random() * 2000; 
            setTimeout(() => {
                createFish();
                startFishGeneration();
            }, interval);
        }

        startFishGeneration();
    </script>
</body>
</html>
